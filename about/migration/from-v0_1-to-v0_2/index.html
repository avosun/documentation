<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        <link rel="canonical" href="https://serp-spider.github.io/documentation/about/migration/from-v0_1-to-v0_2/">
        <link rel="shortcut icon" href="../../../../../../favicon.ico">
        

	    <title>migration 0.2 - Documentation - The SERP Spider</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">        <link href="../../../css/base.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-75620778-1', 'serp-spider.github.io');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="/"><img alt='SERPS logo' src="../../../images/logo.png">SERPS</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../..">Home</a>
</li>

                        
                            
<li >
    <a href="../../../overview/">Overview</a>
</li>

                        
                            
<li >
    <a href="../../../cookies/">Cookies</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Search Engines <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../search-engine/google/">Google</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Http Clients <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../http-client/curl/">CURL</a>
</li>

                        
                            
<li >
    <a href="../../../http-client/phantomJS/">PhantomJS</a>
</li>

                        
                            
<li >
    <a href="../../../http-client/spidyJS/">SpidyJS</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../packages/">Packages</a>
</li>

                        
                            
<li >
    <a href="../../versions/">Versions</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/serp-spider">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">

    <div class="alpha-banner">
        <i class="fa fa-exclamation-circle"></i>
        The project is in alpha phase
        <i class="fa fa-exclamation-circle"></i>
    </div>

    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#migration-from-v01-to-v02">Migration from v0.1 to v0.2</a></li>
        
            <li class="level-2"><a href="#version-02-overview">Version 0.2 overview</a></li>
            
        
            <li class="level-2"><a href="#dependencies">Dependencies</a></li>
            
        
            <li class="level-2"><a href="#request-builder">Request Builder</a></li>
            
        
            <li class="level-2"><a href="#google-client-update">Google: client update</a></li>
            
        
            <li class="level-2"><a href="#google-css-parser">Google: CSS Parser</a></li>
            
        
            <li class="level-2"><a href="#google-image-results">Google: image results</a></li>
            
        
            <li class="level-2"><a href="#google-drop-support-for-raw-parser">Google: drop support for raw parser</a></li>
            
        
            <li class="level-2"><a href="#google-additional-changes">Google: additional changes:</a></li>
            
        
            <li class="level-2"><a href="#url">URL</a></li>
            
        
            <li class="level-2"><a href="#cookie-expiration-time">Cookie expiration time</a></li>
            
        
    
    </ul>
</div></div>
                <div class="col-md-9" id="main-content" role="main">

<h1 id="migration-from-v01-to-v02">Migration from v0.1 to v0.2</h1>
<div class="admonition warning">
<p class="admonition-title">Version not released yet</p>
<p>Be aware that this version is yet under development and this migration guide is a draft that might evolve until
the version is published.</p>
</div>
<h2 id="version-02-overview">Version 0.2 overview</h2>
<p>The version 0.2 brings some improvements that target the future of the library. </p>
<ul>
<li>The version brings better tools to work with captcha. </li>
<li>Some parts from google package are moved to core package 
in order to make them ready for implementing new search engines. </li>
<li>It makes browser emulation more transparent by implementing a browser class that aims to mimic browser.</li>
<li>Url interface was refactored to be more flexible</li>
<li>There are also other changes, see the following guide for a review of the upgrade.</li>
</ul>
<h2 id="dependencies">Dependencies</h2>
<p>Css parser moved from google package to core:</p>
<ul>
<li><code>serps/search-engine-google</code> does not depend on <code>symfony/css-selector</code> anymore</li>
<li><code>serps/core</code> now depends on <code>symfony/css-selector:^2|^3</code></li>
</ul>
<p>Remove PSR-7 implementation:</p>
<ul>
<li><strong>IN PROGRESS</strong> <code>serps/search-engine-google</code> does not depend on <code>zendframework/zend-diactoros</code> anymore,
instead you need to add either <code>zendframework/zend-diactoros</code> or <code>guzzle/psr7</code> to your dependency. </li>
</ul>
<h2 id="request-builder">Request Builder</h2>
<p>Being said in the previous paragraph, serps does not provide a PSR-7 implementation anymore. 
The goal was to let user choose what implementation to depend on. To make it worth serps now provides 
a request builder that will automatically detect what package is installed in your dependencies and create
a request object for you:</p>
<pre><code class="php">    use Serps\Core\Psr7\RequestBuilder;

    $request = RequestBuilder::buildRequest('http://foo.bar', 'GET');
</code></pre>

<h2 id="google-client-update">Google: client update</h2>
<p>This is probably the most sensible change from the upgrade. The google client changed the way it builds requests.</p>
<p>Instead of giving it a <strong>http client</strong> at construction and <strong>proxy</strong> and <strong>cookie jar</strong> at request time, you will now
give it a default browser instance that wraps all of these three items and that can be overriden at request time.
In other words the constructor moved from </p>
<pre><code class="php">    new GoogleClient(HttpClientInterface $client)
</code></pre>

<p>to </p>
<pre><code class="php">    new GoogleClient(BrowserInterface $browser = null)
</code></pre>

<p>And the query method moved from </p>
<pre><code class="php">    GoogleClient::query(GoogleUrlInterface $googleUrl, Proxy $proxy = null, CookieJarInterface $cookieJar = null)
</code></pre>

<p>to </p>
<pre><code class="php">    GoogleClient::query(GoogleUrlInterface $googleUrl, BrowserInterface $browser = null)
</code></pre>

<p>In addition object <code>$googleClient-&gt;request</code>  and method <code>GoogleClient::getRequestBuilder()</code> do not exist anymore,
they are fully replaced by the browser implementation.</p>
<p>The reason of this change is that google client was managing the request by itself. Making it hard to keep a consistent
browser behaviour from different places and that was an issue for managing captcha that need to have the same
browser environment (user-agent string, cookies, proxy...).</p>
<p>Now the google client acts more like a real browser, leaving all the request logic to the browser and it will only
manage the url given to the browser and the response returned from the browser.</p>
<p>Here is an example of how to use it before and after.</p>
<p>Before:</p>
<pre><code class="php">    use Serps\SearchEngine\Google\GoogleClient;
    use Serps\HttpClient\CurlClient;
    use Serps\SearchEngine\Google\GoogleUrl;

    $userAgent = &quot;Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.93 Safari/537.36&quot;;
    $googleClient-&gt;request-&gt;setUserAgent($userAgent);

    $googleClient = new GoogleClient(new CurlClient());

    $response = $googleClient-&gt;query($googleUrl, $someProxy, $someCookies);
</code></pre>

<p>After:</p>
<pre><code class="php">    use Serps\SearchEngine\Google\GoogleClient;
    use Serps\HttpClient\CurlClient;
    use Serps\Core\Browser\Browser;
    use Serps\SearchEngine\Google\GoogleUrl;

    $userAgent = 'Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.93 Safari/537.36';
    $language = 'en-US,en;q=0.8';

    $browser = new Browser(new CurlClient(), $userAgent, $language, $someProxy, $someCookies);

    $googleClient = new GoogleClient($browser);
    $response = $googleClient-&gt;query($googleUrl);

    // Alternatively you can pass browser at request time:
    $googleClient = new GoogleClient();
    $response = $googleClient-&gt;query($googleUrl, $browser);
</code></pre>

<p>As you can see the browser instance manages most of what a real browser would manage (at least for request):</p>
<ul>
<li>User agent string</li>
<li>Language headers (in previous version that was automatically set from the language detected in the google url) </li>
<li>Additional headers</li>
<li>Proxy</li>
<li>Cookie</li>
</ul>
<h2 id="google-css-parser">Google: CSS Parser</h2>
<p>The css parser is not available from google package anymore, if you were using it you will need to rely on the 
replacement from the core package.</p>
<p>Before:</p>
<pre><code class="php">Serps\SearchEngine\Google\Css:::toXPath('.expression');
</code></pre>

<p>After:</p>
<pre><code class="php">Serps\Core\Dom\Css:::toXPath('.expression');
</code></pre>

<h2 id="google-image-results">Google: image results</h2>
<p>Thanks to the addition of the <a href="#MediaInterface">MediaInterface</a> serps makes it easy to work with image results parsed 
from google. </p>
<p>With the previous version image result format was unpredictable: that could be an url, or a base64 image... 
now you wont have to care anymore about this. The only thing in you need to care about is how to store the image.</p>
<p>Concretely the media interface will detect for you the type of image and gives you the possibility to get it
either as a stream, as binary data or as a base64 string or to save it in a file:</p>
<pre><code>    $result-&gt;image-&gt;saveFile('myImage.png');
</code></pre>

<h2 id="google-drop-support-for-raw-parser">Google: drop support for raw parser</h2>
<p>At the very beginning of serps we though it would make sense to provide a raw parser for raw google pages 
(no-javascript pages), but in any case it was useful. Even the results from curl are the same as the javascript ones
and this is due to the fact the the page needs to be evaluated to show a javascript disabled version (curl does 
not evaluate the page, thus it returns almost the same version as the javascript-enabled one).</p>
<p>Maintaining a raw parser was a lot of efforts for a few very results. We simply decided to drop support for the raw parser.</p>
<h2 id="google-additional-changes">Google: additional changes:</h2>
<ul>
<li><code>Serps\SearchEngine\Google\GoogleDom</code> now extends <code>Serps\Core\Dom\WebPage</code> </li>
<li><code>Serps\SearchEngine\Google\GoogleError</code> now extends <code>Serps\Core\Dom\WebPage</code> 
    and does not extend <code>Serps\SearchEngine\Google\GoogleDom</code> anymore</li>
<li>Google cards results are now supported</li>
<li>Mobile page detection: GoogleSerp::isMobile() </li>
<li>Mobile results have now their own parser</li>
<li>Large video have the CLASSICAL type as mentioned in the doc (bugfix)</li>
</ul>
<h2 id="url">URL</h2>
<p>The url interface changed. Most of the changes are internal and you should not be concerned by it.</p>
<p>In case you played with the url, 
see the <a href="https://github.com/serp-spider/core/blob/master/CHANGELOG.md">core changelog</a> for more details</p>
<h2 id="cookie-expiration-time">Cookie expiration time</h2>
<p>Cookie expiration time was not standard and was invalid most of time. Now cookie expiration is correctly managed.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>


                This is an open-source project built for you with <i style="color:#c24b48;" class="fa fa-heart"></i>
                by <a href="https://github.com/gsouf">Soufiane Ghzal</a> and contributors. <br/> The project is being proudly sponsored by <a href="http://www.mondovo.com" target="_blank">Mondovo.com</a>, which uses this script for their <a href="http://www.mondovo.com/rankings-monitor.php" target="_blank">rank tracking service</a>.
                <br/>
                The documentation is generated with <a href="http://www.mkdocs.org/">MkDocs</a>
            </p>
        </footer>

        <script   src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    <script>
        ((window.gitter = {}).chat = {}).options = {
            room: 'serp-spider/help'
        };
        require.config({
            paths: {
                "sidecar": "https://sidecar.gitter.im/dist/sidecar.v1"
            }
        });
        require( ["sidecar"], function ($) {
                    console.log('sidecar loaded');
                }
        );
    </script>

    </body>
</html>
